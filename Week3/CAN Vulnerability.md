CAN Vulnerability
==================
2015 Jeep Cherokee Hacking
&nbsp;

https://www.youtube.com/watch?v=MK0SrxBC1xs
&nbsp;

https://illmatics.com/Remote%20Car%20Hacking.pdf
&nbsp;

2015년에 Charlie Miller와 Chris Valasek가 Jeep의 Cherokee 모델을 해킹한 사건. 고속주행 중인 차량을 장거리에서 무선으로 공격할 수 있다는 것을 시연했으며, 비슷한 취약점을 가진 다양한 모델을 함께 공개함.
&nbsp;
&nbsp;

## 해킹 절차
### 공격 표면
- Jeep Cherokee에는 Uconnect라는 인포테인먼트 시스템 탑재
- Uconnect는 LTE를 통해 외부와 연결되어 다양한 기능 제공.
&nbsp;
&nbsp;

### RCE 취약점 탐색
- RCE (Remote Code Execution): 외부에서 원격으로 코드를 실행시킬 수 있는 취약점. 다양한 방식으로 접근이 가능함.
- Uconnect의 web 인터페이스에 입력 검증이 없음. 특정 HTTP 요청에 command injection을 실행해서 쉘 명령 실행.
- 이 과정을 통해 시스템 권한 쉘 획득.
- (보고서에 따르면,) 이 command injection조차 필요가 없었음. execute() API가 인증 없이 사용 가능했기 때문.
&nbsp;
&nbsp;

### CAN bus 접근
```
[Celular Network] ⇄ [Uconnect] ⇄ [Gateway] ⇄ [CAN Bus] ⇄ [ECU]
```
- Uconnect는 내부적으로 Gateway, CAN bus, ECU들과 연결되어 있음. 
- Uconnect에 명령을 직접적으로 전송할 수 있는 권한이 생겼으므로, 이제 ECU를 직접 조작 가능.
&nbsp;
&nbsp;

### 주요 취약점?
- Uconnect의 IP 주소가 노출되어 있음
- Uconnect의 API가 인증 없이 노출됨.
- CAN bus: 암호화 및 인증이 없음
- IVI <-> Gateway <-> CAN 의 분리가 없음.
&nbsp;
&nbsp;

### 이후 보안 대책
- Gateway가 whitelist 기반으로 IVI에서 들어오는 메세지 필터링.
- CAN-FD를 도입해 메세지에 MAC을 추가
- ECU 인증 절차 도입
- UNECE WP.29 등 보안 표준 등장
- IVI부터 ECU까지 모두 연결되지 않고, 각 도메인 분리. 도메인끼리는 gateway를 통해서만 통신.

&nbsp;
---
&nbsp;

## 테슬라 모델 S 해킹

https://www.blackhat.com/docs/us-17/thursday/us-17-Nie-Free-Fall-Hacking-Tesla-From-Wireless-To-CAN-Bus-wp.pdf

2016~2017년 Keen Security Lab에서 진행한 Tesla Model S 원격 해킹
&nbsp;
&nbsp;

## 해킹 절차

### RCE 취약점
- 테슬라 차량의 기본 SSID를 스푸핑하여 wi-fi 자동연결 유도
- QtWebKit 브라우저의 취약점 이용
- JSArray::sort()의 문제점
- importNode()의 문제점
- 위의 두 JS 취약점을 이용해 RCE 성공
&nbsp;
&nbsp;

### 취약점. sort()
- sort()에서 비교함수로 잘못된 함수를 전달하면 내부 배열이 변경됨.
- 그러나, 기존의 포인터는 동일한 곳을 참조.
- 이를 이용해 데이터 유출 또는 덮어쓰기 가능.
&nbsp;
&nbsp;

### 취약점. importNode()
- Element로 취급되는 비표준 노드 생성
- importNode()를 호출(강제변환)하면, 두 노드가 겹쳐짐.
```
struct Element {            // 52 bytes
    void* m_next;           // 4 bytes
    ...
};

struct HTMLInputElement {   // 124 bytes
    void* m_data;           // 4 bytes
    bool m_isChecked;       // 1 byte
    ..
};

// importNode를 호출하면, 사용자가 조작한 m_next를 m)data로 착각시킬 수 있음.
```
&nbsp;
&nbsp;

### LPE
- Local Privalage Escalation: 권한을 올리는 기술
- CID: 테슬라의 infoteinment
- CID의 ARM 커널에 취약점 존재. 메모리 접근에 대한 권한 확인 부족.
- syscall을 조작해 UID를 0(root)으로 설정.
&nbsp;
&nbsp;

이후에는 jeep와 동일하게 CAN에 명령 전달.
&nbsp;
&nbsp;

Tesla의 사례에서, Gateway에 대한 인증 및 검증의 부재가 문제되었음.
- Webkit 업데이트
- Gateway 인증 메세지 도입
- Jeep과는 달리 업데이트로 해결가능해 리콜하지 않았음.


&nbsp;
---
&nbsp;

# Vulnerability Scanning

Vulnerability Scan이란, 시스템, 네트워크, 어플리케이션에 대해 알려진 보안 취약점들에 대해 탐색을 진행하는 보안 프로세스를 말한다.
- OWASP Tope10(https://owasp.org/www-project-top-ten/): OWASP에서 규정한 10가지 주요 보안 취약점
&nbsp;
&nbsp;

### Vehicle Regulation
- 차량 통신에 관해서, 국제 표준이 존재함
- UN Regulation No. 155: https://unece.org/sites/default/files/2023-02/R155e%20%282%29.pdf
- ISO/SAE 21434: https://cdn.standards.iteh.ai/samples/70918/9c85ee86ba1945fe845ac38711773665/ISO-SAE-21434-2021.pdf
&nbsp;
&nbsp;

### 간단설명
```
Clause 4 (General considerations) is informational and includes the context and perspective of the approach to road vehicle cybersecurity engineering taken in this document.

Clause 5 (Organizational cybersecurity management) includes the cybersecurity management and specification of the organizational cybersecurity policies, rules and processes.

Clause 6 (Project dependent cybersecurity management) includes the cybersecurity management and cybersecurity activities at the project level.

Clause 7 (Distributed cybersecurity activities) includes requirements for assigning responsibilities for cybersecurity activities between customer and supplier.

Clause 8 (Continual cybersecurity activities) includes activities that provide information for ongoing risk assessments and defines vulnerability management of E/E systems until end of cybersecurity support.

Clause 9 (Concept) includes activities that determine cybersecurity risks, cybersecurity goals and cybersecurity requirements for an item.

Clause 10 (Product development) includes activities that define the cybersecurity specifications, and implement and verify cybersecurity requirements.

Clause 11 (Cybersecurity validation) includes the cybersecurity validation of an item at the vehicle level.

Clause 12 (Production) includes the cybersecurity-related aspects of manufacturing and assembly of an item or component.

Clause 13 (Operations and maintenance) includes activities related to cybersecurity incident response and updates to an item or component.

Clause 14 (End of cybersecurity support and decommissioning) includes cybersecurity considerations for end of support and decommissioning of an item or component.

Clause 15 (Threat analysis and risk assessment methods) includes modular methods for analysis and assessment to determine the extent of cybersecurity risk so that treatment can be pursued.

Clauses 5 through 15 have their own objectives, provisions (i.e. requirements, recommendations, permissions) and work products. Work
```
- ISO/SAE 표준의 경우 위의 clause들을 기준으로 각 clause에 대한 세부 셜명들이 기록되어 있음.
- UN R155의 경우, 보안 인증의 필요성 및 보안 인증 절차에 대해 설명. 공격 시나리오도 설명하고 있음.
